<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.classservice.dao.StudentDao">

    <!-- 通用结果映射 -->
    <resultMap id="StudentVOMap" type="com.example.classservice.vo.StudentVO">
        <id column="id" property="id"/>
        <result column="student_no" property="studentNo"/>
        <result column="student_name" property="studentName"/>
        <result column="gender" property="gender"/>
        <result column="birth_date" property="birthDate"/>
        <result column="class_id" property="classId"/>
        <result column="class_name" property="className"/>
        <result column="grade_id" property="gradeId"/>
        <result column="grade_name" property="gradeName"/>
    </resultMap>

    <!-- 查询班级学生列表 -->
    <select id="selectStudentsByClassId" resultMap="StudentVOMap">
        SELECT
            s.id,
            s.student_no,
            s.student_name,
            s.gender,
            s.birth_date,
            s.class_id,
            c.class_name,
            s.grade_id,
            g.grade_name
        FROM edu_student s
        LEFT JOIN edu_class c ON s.class_id = c.id AND c.is_deleted = 0
        LEFT JOIN edu_grade g ON s.grade_id = g.id AND g.is_deleted = 0
        WHERE s.is_deleted = 0
        <if test="classId != null">
            AND s.class_id = #{classId}
        </if>
        ORDER BY s.student_no ASC
    </select>

</mapper>
